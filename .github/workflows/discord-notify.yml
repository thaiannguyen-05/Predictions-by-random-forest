name: ğŸš¨ Notify Discord on Repo Activity

on:
  push:
    branches: ["*"]                 # má»i branch
  pull_request:
    types: [opened, closed, reopened]   # merge sáº½ náº±m trong closed
  issues:
    types: [opened, closed, reopened]
  release:
    types: [published]
  create:
  delete:
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§¾ Build Discord message
        id: build_message
        run: |
          EVENT_NAME="${{ github.event_name }}"
          ACTOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          REF="${{ github.ref_name }}"
          MESSAGE=""
          URL="https://github.com/${REPO}"

          case "$EVENT_NAME" in
            push)
              COMMIT_MSG="${{ github.event.head_commit.message }}"
              MESSAGE="ğŸš€ **Push má»›i lÃªn GitHub**
              ğŸ‘¤ *${ACTOR}* vá»«a push lÃªn **${REF}**
              ğŸ’¬ Commit: ${COMMIT_MSG}"
              ;;
            pull_request)
              PR_TITLE="${{ github.event.pull_request.title }}"
              PR_URL="${{ github.event.pull_request.html_url }}"
              ACTION="${{ github.event.action }}"
              MERGED="${{ github.event.pull_request.merged }}"
              if [ "$ACTION" = "closed" ] && [ "$MERGED" = "true" ]; then
                MESSAGE="âœ… **Pull Request merged!**
                ğŸ‘¤ *${ACTOR}* Ä‘Ã£ merge PR: **${PR_TITLE}**
                ğŸ”— [Xem PR](${PR_URL})"
              else
                MESSAGE="ğŸ”€ **Pull Request ${ACTION}!**
                ğŸ‘¤ *${ACTOR}* ${ACTION} PR: **${PR_TITLE}**
                ğŸ”— [Xem PR](${PR_URL})"
              fi
              ;;
            issues)
              ISSUE_TITLE="${{ github.event.issue.title }}"
              ISSUE_URL="${{ github.event.issue.html_url }}"
              ACTION="${{ github.event.action }}"
              MESSAGE="ğŸ“ **Issue ${ACTION}!**
              ğŸ‘¤ *${ACTOR}* ${ACTION} issue: **${ISSUE_TITLE}**
              ğŸ”— [Xem issue](${ISSUE_URL})"
              ;;
            release)
              RELEASE_NAME="${{ github.event.release.name }}"
              RELEASE_URL="${{ github.event.release.html_url }}"
              MESSAGE="ğŸ **Release má»›i Ä‘Æ°á»£c publish!**
              ğŸ‘¤ *${ACTOR}*
              ğŸ·ï¸ Release: **${RELEASE_NAME}**
              ğŸ”— [Xem release](${RELEASE_URL})"
              ;;
            create)
              REF_TYPE="${{ github.event.ref_type }}"
              REF_NAME="${{ github.event.ref }}"
              MESSAGE="ğŸŒ¿ **Táº¡o má»›i ${REF_TYPE}:**
              ğŸ‘¤ *${ACTOR}* vá»«a táº¡o **${REF_NAME}**"
              ;;
            delete)
              REF_TYPE="${{ github.event.ref_type }}"
              REF_NAME="${{ github.event.ref }}"
              MESSAGE="ğŸ”¥ **XÃ³a ${REF_TYPE}:**
              ğŸ‘¤ *${ACTOR}* vá»«a xÃ³a **${REF_NAME}**"
              ;;
            *)
              MESSAGE="âš¡ **Sá»± kiá»‡n:** ${EVENT_NAME}
              ğŸ‘¤ *${ACTOR}* hoáº¡t Ä‘á»™ng trong repo *${REPO}*"
              ;;
          esac

          echo "message<<EOF" >> $GITHUB_OUTPUT
          echo "$MESSAGE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: ğŸ“¢ Gá»­i thÃ´ng bÃ¡o lÃªn Discord
        uses: Ilshidur/action-discord@master
        with:
          args: ${{ steps.build_message.outputs.message }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
