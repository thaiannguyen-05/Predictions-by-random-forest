model UserDevice {
    id         String   @id @default(uuid()) @map("device_id") @db.Uuid
    nameDevice String   @map("device_name")
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")
    // foreign keys
    userId     String   @map("user_id") @db.Uuid

    //relation
    user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userSession Session?

    @@unique([nameDevice, userId])
    @@index([userId])
    @@map("user_devices")
}

model Session {
    id                 String   @id @default(uuid()) @map("session_id") @db.Uuid
    hashedRefreshToken String?  @map("hashed_refresh_token")
    userIp             String   @map("user_ip")
    createdAt          DateTime @default(now()) @map("created_at")
    updatedAt          DateTime @updatedAt @map("updated_at")

    // foreign keys
    userDeviceId String     @unique @map("user_device_id") @db.Uuid
    userId       String     @map("user_id") @db.Uuid
    // relations
    userDevice   UserDevice @relation(fields: [userDeviceId], references: [id], onDelete: Cascade)
    user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([userId, userDeviceId])
    @@index([userId])
    @@index([userDeviceId])
    @@map("sessions")
}

model Code {
    id        String   @id @default(uuid()) @map("code_id") @db.Uuid
    code      String   @db.VarChar(255)
    type      CodeType @default(VERIFICATION) @map("code_type")
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
    updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz()

    // foreign keys
    userId String @map("user_id") @db.Uuid

    // relations
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([code, userId])
    @@index([userId])
    @@map("codes")
}
