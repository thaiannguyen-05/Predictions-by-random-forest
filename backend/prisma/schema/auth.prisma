model UserDevice {
    id         String   @id @default(uuid()) @map("device_id") @db.Uuid
    nameDevice String   @map("device_name") 
    createdAt  DateTime @default(now()) @map("created_at")
    updatedAt  DateTime @updatedAt @map("updated_at")
    // foreign keys
    userId     String   @map("user_id") @db.Uuid

    //relation
    user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
    userSession Session?

    @@index([userId])
    @@unique([nameDevice, userId])
    @@map("user_devices")
}

model Session {
    id                 String   @id @default(uuid()) @map("session_id") @db.Uuid
    hashedRefreshToken String?   @map("hashed_refresh_token")
    userIp             String   @map("user_ip")
    createdAt          DateTime @default(now()) @map("created_at")
    updatedAt          DateTime @updatedAt @map("updated_at")

    // foreign keys
    userDeviceId String     @unique @map("user_device_id") @db.Uuid
    userId       String     @map("user_id") @db.Uuid
    // relations
    userDevice   UserDevice @relation(fields: [userDeviceId], references: [id], onDelete: Cascade)
    user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@index([userDeviceId])
    @@unique([userId, userDeviceId])
    @@map("sessions")
}

model Oauth2User {
    id             String   @id @default(uuid()) @db.Uuid
    provider       Provider
    providerUserId String   @map("provider_user_id") @db.VarChar(500)
    email          String   @unique @db.VarChar(255)
    phone          String?  @db.VarChar(20)
    firstname      String?  @db.VarChar(50)
    lastname       String?  @db.VarChar(50)
    fullname       String?  @db.VarChar(50)
    avatarUrl      String?  @map("avatar_url") @db.VarChar(500)
    username       String?  @db.VarChar(50)
    createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz()
    updatedAt      DateTime @updatedAt @map("updated_at") @db.Timestamptz()

    @@map("oauth2_user")
}

model Code {
    id        String   @id @default(uuid()) @map("code_id") @db.Uuid
    code      String   @db.VarChar(255)
    type      CodeType @default(VERIFICATION) @map("code_type")
    createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
    updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz()

    // foreign keys
    userId String @map("user_id") @db.Uuid

    // relations
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([code, userId])
    @@index([userId])
    @@map("codes")
}

enum Provider {
    FACEBOOK
    GOOGLE
}

enum CodeType {
    VERIFICATION
    PASSWORD_RESET
    EMAIL_CHANGE
    PHONE_CHANGE
}
